<link href="https://cdn.jsdelivr.net/npm/quill@1.3.7/dist/quill.snow.css" rel="stylesheet">

<div class="admin-card">
  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
    <h2><i class='bx bx-key'></i> Company Credentials</h2>
    <form method="POST" action="/admin/credentials/lock" style="display: inline;">
      <button type="submit" class="btn btn-sm" style="background: #6c757d;">Lock</button>
    </form>
  </div>

  {{#if flash.success}}<div class="flash-success">{{flash.success}}</div>{{/if}}
  {{#if flash.error}}<div class="flash-error">{{flash.error}}</div>{{/if}}

  <form method="POST" action="/admin/credentials/save" id="credentials-form">
    <input type="hidden" name="content" id="content-input">
    <div class="form-group">
      <label>Credentials (stored encrypted)</label>
      <p style="font-size: 13px; color: #64748b; margin-bottom: 10px;">Paste text, images, and links. Use the toolbar for font, size, and color.</p>
      <div id="cred-init-content" style="display:none">{{{content}}}</div>
      <div id="quill-editor" style="min-height: 400px; background: #fff;"></div>
    </div>
    <button type="submit" class="btn btn-admin">Save</button>
  </form>
</div>

<style>
  .ql-toolbar.ql-snow { border-radius: 8px 8px 0 0; border-color: #e2e8f0; background: #f8fafc; }
  .ql-container.ql-snow { border-radius: 0 0 8px 8px; border-color: #e2e8f0; font-size: 14px; }
  .ql-editor { min-height: 360px; max-height: 500px; overflow-y: auto; }
  .ql-editor.ql-blank::before { color: #94a3b8; font-style: normal; }
  .ql-editor .ql-font-times { font-family: "Times New Roman", serif !important; }
  .ql-editor .ql-font-calibri { font-family: Calibri, sans-serif !important; }
  .ql-editor .ql-font-arial { font-family: Arial, sans-serif !important; }
  .ql-editor .ql-font-cambria { font-family: Cambria, Georgia, serif !important; }
  .ql-editor .ql-font-georgia { font-family: Georgia, serif !important; }
  .ql-editor .ql-font-verdana { font-family: Verdana, sans-serif !important; }
  .ql-editor .ql-font-garamond { font-family: Garamond, serif !important; }
  .ql-editor .ql-font-tahoma { font-family: Tahoma, Geneva, sans-serif !important; }
  .ql-editor .ql-font-segoe-ui { font-family: "Segoe UI", Tahoma, sans-serif !important; }
  .ql-editor .ql-font-helvetica { font-family: Helvetica, Arial, sans-serif !important; }
  .ql-snow .ql-picker.ql-font .ql-picker-label[data-value="times"]::before,
  .ql-snow .ql-picker.ql-font .ql-picker-item[data-value="times"]::before { content: "Times New Roman" !important; font-family: "Times New Roman", serif !important; }
  .ql-snow .ql-picker.ql-font .ql-picker-label[data-value="calibri"]::before,
  .ql-snow .ql-picker.ql-font .ql-picker-item[data-value="calibri"]::before { content: "Calibri" !important; font-family: Calibri, sans-serif !important; }
  .ql-snow .ql-picker.ql-font .ql-picker-label[data-value="arial"]::before,
  .ql-snow .ql-picker.ql-font .ql-picker-item[data-value="arial"]::before { content: "Arial" !important; font-family: Arial, sans-serif !important; }
  .ql-snow .ql-picker.ql-font .ql-picker-label[data-value="cambria"]::before,
  .ql-snow .ql-picker.ql-font .ql-picker-item[data-value="cambria"]::before { content: "Cambria" !important; font-family: Cambria, Georgia, serif !important; }
  .ql-snow .ql-picker.ql-font .ql-picker-label[data-value="georgia"]::before,
  .ql-snow .ql-picker.ql-font .ql-picker-item[data-value="georgia"]::before { content: "Georgia" !important; font-family: Georgia, serif !important; }
  .ql-snow .ql-picker.ql-font .ql-picker-label[data-value="verdana"]::before,
  .ql-snow .ql-picker.ql-font .ql-picker-item[data-value="verdana"]::before { content: "Verdana" !important; font-family: Verdana, sans-serif !important; }
  .ql-snow .ql-picker.ql-font .ql-picker-label[data-value="garamond"]::before,
  .ql-snow .ql-picker.ql-font .ql-picker-item[data-value="garamond"]::before { content: "Garamond" !important; font-family: Garamond, serif !important; }
  .ql-snow .ql-picker.ql-font .ql-picker-label[data-value="tahoma"]::before,
  .ql-snow .ql-picker.ql-font .ql-picker-item[data-value="tahoma"]::before { content: "Tahoma" !important; font-family: Tahoma, Geneva, sans-serif !important; }
  .ql-snow .ql-picker.ql-font .ql-picker-label[data-value="segoe-ui"]::before,
  .ql-snow .ql-picker.ql-font .ql-picker-item[data-value="segoe-ui"]::before { content: "Segoe UI" !important; font-family: "Segoe UI", Tahoma, sans-serif !important; }
  .ql-snow .ql-picker.ql-font .ql-picker-label[data-value="helvetica"]::before,
  .ql-snow .ql-picker.ql-font .ql-picker-item[data-value="helvetica"]::before { content: "Helvetica" !important; font-family: Helvetica, Arial, sans-serif !important; }
  .ql-snow .ql-picker.ql-size .ql-picker-item[data-value="8px"]::before { font-size: 8px !important; content: "8px" !important; }
  .ql-snow .ql-picker.ql-size .ql-picker-item[data-value="10px"]::before { font-size: 10px !important; content: "10px" !important; }
  .ql-snow .ql-picker.ql-size .ql-picker-item[data-value="12px"]::before { font-size: 12px !important; content: "12px" !important; }
  .ql-snow .ql-picker.ql-size .ql-picker-item[data-value="14px"]::before { font-size: 14px !important; content: "14px" !important; }
  .ql-snow .ql-picker.ql-size .ql-picker-item[data-value="16px"]::before { font-size: 16px !important; content: "16px" !important; }
  .ql-snow .ql-picker.ql-size .ql-picker-item[data-value="18px"]::before { font-size: 18px !important; content: "18px" !important; }
  .ql-snow .ql-picker.ql-size .ql-picker-item[data-value="20px"]::before { font-size: 20px !important; content: "20px" !important; }
  .ql-snow .ql-picker.ql-size .ql-picker-item[data-value="24px"]::before { font-size: 24px !important; content: "24px" !important; }
  .ql-snow .ql-picker.ql-size .ql-picker-item[data-value="28px"]::before { font-size: 28px !important; content: "28px" !important; }
  .ql-snow .ql-picker.ql-size .ql-picker-item[data-value="32px"]::before { font-size: 32px !important; content: "32px" !important; }
  .ql-snow .ql-picker.ql-size .ql-picker-item[data-value="36px"]::before { font-size: 36px !important; content: "36px" !important; }
  .ql-editor .ql-size-8px { font-size: 8px !important; }
  .ql-editor .ql-size-10px { font-size: 10px !important; }
  .ql-editor .ql-size-12px { font-size: 12px !important; }
  .ql-editor .ql-size-14px { font-size: 14px !important; }
  .ql-editor .ql-size-16px { font-size: 16px !important; }
  .ql-editor .ql-size-18px { font-size: 18px !important; }
  .ql-editor .ql-size-20px { font-size: 20px !important; }
  .ql-editor .ql-size-24px { font-size: 24px !important; }
  .ql-editor .ql-size-28px { font-size: 28px !important; }
  .ql-editor .ql-size-32px { font-size: 32px !important; }
  .ql-editor .ql-size-36px { font-size: 36px !important; }
</style>

<script src="https://cdn.jsdelivr.net/npm/quill@1.3.7/dist/quill.js"></script>
<script>
(function() {
  var Font = Quill.import('formats/font');
  Font.whitelist = ['times', 'calibri', 'arial', 'cambria', 'georgia', 'verdana', 'garamond', 'tahoma', 'segoe-ui', 'helvetica'];
  Quill.register(Font, true);

  var Size = Quill.import('attributors/style/size');
  Size.whitelist = ['8px', '10px', '12px', '14px', '16px', '18px', '20px', '24px', '28px', '32px', '36px'];
  Quill.register(Size, true);

  var quill = new Quill('#quill-editor', {
    theme: 'snow',
    placeholder: 'Paste or type your credentials here. Images from clipboard are supported.',
    modules: {
      toolbar: [
        [{ 'font': ['times', 'calibri', 'arial', 'cambria', 'georgia', 'verdana', 'garamond', 'tahoma', 'segoe-ui', 'helvetica'] }],
        [{ 'size': ['8px', '10px', '12px', '14px', '16px', '18px', '20px', '24px', '28px', '32px', '36px'] }],
        ['bold', 'italic', 'underline', 'strike'],
        [{ 'color': [] }, { 'background': [] }],
        [{ 'list': 'ordered' }, { 'list': 'bullet' }],
        ['link', 'image'],
        ['clean']
      ]
    }
  });

  var initEl = document.getElementById('cred-init-content');
  if (initEl && initEl.innerHTML) quill.root.innerHTML = initEl.innerHTML;

  quill.root.addEventListener('paste', function(e) {
    var items = e.clipboardData && e.clipboardData.items;
    if (items) {
      for (var i = 0; i < items.length; i++) {
        if (items[i].type.indexOf('image') !== -1) {
          e.preventDefault();
          var file = items[i].getAsFile();
          var reader = new FileReader();
          reader.onload = function(ev) {
            var range = quill.getSelection(true) || { index: quill.getLength() };
            quill.insertEmbed(range.index, 'image', ev.target.result, 'user');
            quill.setSelection(range.index + 1);
          };
          reader.readAsDataURL(file);
          return;
        }
      }
    }
  });

  var toolbar = quill.getModule('toolbar');
  toolbar.addHandler('image', function() {
    var input = document.createElement('input');
    input.setAttribute('type', 'file');
    input.setAttribute('accept', 'image/*');
    input.onchange = function() {
      var file = input.files && input.files[0];
      if (file) {
        var reader = new FileReader();
        reader.onload = function(ev) {
          var range = quill.getSelection(true) || { index: quill.getLength() };
          quill.insertEmbed(range.index, 'image', ev.target.result, 'user');
          quill.setSelection(range.index + 1);
        };
        reader.readAsDataURL(file);
      }
    };
    input.click();
  });

  document.getElementById('credentials-form').onsubmit = function() {
    document.getElementById('content-input').value = quill.root.innerHTML;
    return true;
  };
})();
</script>
